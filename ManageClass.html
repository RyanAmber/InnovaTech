<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Manage Classroom</title>
    <link rel="stylesheet" href="ManageClass.css" />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDq7FI-N984HO2M7Q0l25WEoiTBqZvZfHs",
        authDomain: "innovatech-86917.firebaseapp.com",
        projectId: "innovatech-86917",
        storageBucket: "innovatech-86917.appspot.com",
        messagingSenderId: "222788972248",
        appId: "1:222788972248:web:d0d5b8968f24b9c00671ad",
        measurementId: "G-GTX1QPXJ2R"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    </script>
  </head>

  <body>
    <div class="container">
      <!-- Dashboard button in top-right corner -->
      <div class="dashboard-button-wrapper">
        <button type="button" onclick="location.href='TeacherDashboard.html'">
          Back to Dashboard
        </button>
      </div>

      <h1>Manage Classroom</h1>

      <!-- MAIN CONTENT GRID -->
      <div class="main-content">
        <!-- COLUMN 1: OVERVIEW -->
        <div class="column">
          <div class="section-header">Overview</div>
          <div class="section">
            <h2>For approval</h2>
            <ul class="approval-list">
              <li>
                <span class="dot green"></span>
                191966
              </li>
              <li>
                <span class="dot red"></span>
                spammmm
              </li>
              <li>
                <span class="dot green"></span>
                192832
              </li>
            </ul>

            <h2>Current List</h2>
            <ul class="current-list" id="current-list">
              
            </ul>
          </div>
        </div>

        <!-- COLUMN 2: TEAMS -->
        <div class="column">
          <div class="section-header">Teams</div>
          <div class="section teams">
            <p class="instruction">Groups and members:</p>
            <div class="id-boxes" id="id-boxes">
              <!-- “Add new team” card -->
              <div class="id-box">
                <input type="text" placeholder="enter team name" /><br />
                <input type="text" placeholder="search members..." /><br />
                <button class="add-btn">add</button>
              </div>

              <!-- Existing group: InnovaTech -->
              <div class="id-box">
                <strong>InnovaTech</strong><br />
                Radhana_Mainali<br />
                Ryan_Diehl<br />
                Conrad_Kim<br />
                Suhanee_Patel<br />
                <button class="remove-btn">delete</button>
              </div>

              <!-- Existing group: Team X6 -->
              <div class="id-box">
                <strong>Team X6</strong><br />
                Radhana_Mainali<br />
                Poorvi_Deshpande<br />
                Conrad_Kim<br />
                Ethan_Cho<br />
                <button class="remove-btn">delete</button>
              </div>

              <!-- Placeholder “+” cards (total should equal 16 cards) -->
              <div class="id-box plus">+</div>
              <div class="id-box plus">+</div>
              <div class="id-box plus">+</div>
              <div class="id-box plus">+</div>
              <div class="id-box plus">+</div>
              <div class="id-box plus">+</div>
              <div class="id-box plus">+</div>
              <div class="id-box plus">+</div>
            </div>
          </div>
        </div>

        <!-- COLUMN 3: FLAGGED -->
        <div class="column">
          <div class="section-header">Flagged</div>
          <div class="section flagged">
            <p>(Placeholder for flagged users)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Firebase loading script -->
    <script>
       async function loadGroupsFromFirebase() {
      const groupContainer = document.getElementById("id-boxes");
    const currentListEl = document.getElementById("current-list");

    const uniqueUsers = new Map(); // To avoid duplicates

      try {
        const groupsSnapshot = await db.collection("Groups").get();

        for (const groupDoc of groupsSnapshot.docs) {
          const groupName = groupDoc.id;
          const usersRef = db
              .collection("Groups")
              .doc(groupName)
              .collection("Users");
          const usersSnapshot = await usersRef.get();


          const userList = [];
  
        usersSnapshot.forEach((userDoc) => {
          const username = userDoc.id;
          const data = userDoc.data();
          const role = data.role || "student"; // default role
          const roleBadge = role === "student" ? `<span class="role-student">[Student]</span>` : "";

          // For team section (middle column)
          userList.push(`${username} ${roleBadge}`);

          // For current list (left column)
          if (!uniqueUsers.has(username)) {
            uniqueUsers.set(username, role);
          }
        });

        // Create and append team box
          const box = document.createElement("div");
          box.className = "id-box";
          box.innerHTML = `
            <strong>${groupName}</strong><br>
            ${userList.join("<br>") || "<em>No users</em>"}<br>
            <button class="remove-btn">delete</button>
          `;
          groupContainer.appendChild(box);
        }

      // Populate Current List
      for (const [username, role] of uniqueUsers.entries()) {
        const li = document.createElement("li");
        const roleBadge = role === "student" ? `<span class="role-student">[Student]</span>` : "";
        li.innerHTML = `${username} ${roleBadge} <button class="remove-btn">remove</button>`;
        currentListEl.appendChild(li);
      }

      } catch (error) {
        console.error("Error loading groups from Firebase:", error);
      }
    }

    
      window.onload = () => {
        loadGroupsFromFirebase();
      };
    </script>
  </body>
</html>
